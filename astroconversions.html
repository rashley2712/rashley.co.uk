<html>
	<head>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<title>rashley.co.uk</title>
	</head>

<script src="jquery.min.js"></script>
<script src="astrotools.js"></script>

<script type="text/javascript">
	// Call my start up method after the page has finished loading
	window.addEventListener("load", eventWindowLoaded, false);
	
	var defaultTextAreaText = "Copy and paste coordinates here...";
	
	function eventWindowLoaded() {
		console.log("The page has loaded.");
		$("#positions").text(defaultTextAreaText);
		addExample();
	}
	
	function selectText() {
		if ($("#positions").text() == defaultTextAreaText) $("#positions").text("test");
	}
	
	function convertText() {
		convertString = $("#positions").val();
		results = "";
		console.log("Converting:\n" + convertString);
		lines = convertString.split("\n");
		for (l in lines) {
			console.log(l + ": " + lines[l]);
			results+= fromSexagesimal(lines[l]) + "\n";
		}	
		$("#results").text(results);	
	}
	
	function addExample() {
		var example = "20 59 21.82 +44 39 22\n19 34 21 -21 18 32\nfdsdskl slkd slk\n11:23:14 -48:09:06.81";
		$("#positions").text(example);
	}
	
	function fromSexagesimal(radecStr) {
	// Format for input ra and dec are 'HH:MM:SS.dd' and 'nDD:MM:SS.dd' or HH MM SS.dd and nDD MM SS.dd 
	// Returns a string of RA, DEC in degrees separated by a comma or "null, null if it could not parse the input correctly 
	// Results are truncated to 4 figures after the decimal (1E-4 degrees)
	                                                                               
		var separator = ':';
		console.log("Input string", radecStr);
		if (radecStr.indexOf(separator)==-1) { 
			separator = ' '; 
			radecPieces = radecStr.split(separator);
		} else {
			raPart = radecStr.split(' ')[0];
			radecPieces = raPart.split(separator);
			decPart = radecStr.split(' ')[1];
			decPieces = decPart.split(':');
			radecPieces = radecPieces.concat(decPieces);
		}
		console.log(radecPieces);
		if (radecPieces.length < 6) {
			console.log("Could not sensibly parse the line: " + radecStr);
			return "null, null";
			}
		raHours = parseInt(radecPieces[0]);
		raMinutes = parseInt(radecPieces[1]);
		raSeconds = parseFloat(radecPieces[2]);
		ra = 15 * (raHours + raMinutes/60.0 + raSeconds / 3600.0);
		
		if (radecPieces[3][0]=='-') south = true;
		else south = false;
		
		decDegrees = parseInt(radecPieces[3]);
		decMinutes = parseInt(radecPieces[4]);
		decSeconds = parseFloat(radecPieces[5]);
	
		if (south) dec = decDegrees - decMinutes/60.0 - decSeconds / 3600.0;
		else dec = decDegrees + decMinutes/60.0 + decSeconds / 3600.0;
		
		console.log(raHours, raMinutes, raSeconds, decDegrees, decMinutes, decSeconds);
		console.log(ra + ", " + dec);
			
		return ra + ", " + dec;
	}
</script>	
	


<body>
<form>
<textarea id="positions" rows="10" cols="40" onfocus="selectText()" oninput="convertText(this.value)">.</textarea>
<input type="button" value="example" onclick="addExample()"/>
<label for="positions">Positions</label><br/>
<input type="button" value="Convert" onclick="convertText()"/><hr/>
<textarea id="results" rows="10" cols="40">.</textarea>
</form>
</body>

</html>
